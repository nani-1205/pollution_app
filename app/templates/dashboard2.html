{% extends 'base.html' %}

{% block title %}Reports Dashboard{% endblock %}

{% block content %}
<div class="card shadow-sm mb-4">
    <div class="card-header bg-info text-dark">
        <h4 class="mb-0">Generate Reports</h4>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('main.dashboard2') }}">
            <div class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label for="start_date" class="form-label">Start Date</label>
                    <input type="date" class="form-control" id="start_date" name="start_date" value="{{ start_date or '' }}" required>
                </div>
                <div class="col-md-4">
                    <label for="end_date" class="form-label">End Date</label>
                    <input type="date" class="form-control" id="end_date" name="end_date" value="{{ end_date or '' }}" required>
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary w-100">Generate Report</button>
                </div>
            </div>
        </form>
    </div>
</div>

{% if report_data is not none %}
    {% if report_data %} {# Check if report_data is not empty #}
        <div class="row">
            <!-- Summary Cards -->
            <div class="col-md-4">
                <div class="card text-center border-primary">
                    <div class="card-header bg-primary text-white">Total Sales</div>
                    <div class="card-body">
                        <h3 class="card-title">â‚¹ {{ "%.2f"|format(report_data.total_sales or 0) }}</h3>
                    </div>
                     <div class="card-footer text-muted">
                        {{ report_data.total_checks or 0 }} Checks Total
                    </div>
                </div>
            </div>
             <div class="col-md-4">
                <div class="card text-center border-success">
                    <div class="card-header bg-success text-white">Checks by Wheels</div>
                    <div class="card-body">
                       <p class="card-text mb-1">2W: {{ report_data.counts_by_wheel.get('2', 0) }}</p>
                       <p class="card-text mb-1">3W: {{ report_data.counts_by_wheel.get('3', 0) }}</p>
                       <p class="card-text mb-0">4W: {{ report_data.counts_by_wheel.get('4', 0) }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                 <div class="card text-center border-warning">
                    <div class="card-header bg-warning text-dark">Checks by Duration</div>
                    <div class="card-body">
                       <p class="card-text mb-1">6 Months: {{ report_data.counts_by_duration.get('6', 0) }}</p>
                       <p class="card-text mb-0">1 Year: {{ report_data.counts_by_duration.get('12', 0) }}</p>
                    </div>
                </div>
            </div>
             <div class="col-md-4">
                 <div class="card text-center border-secondary mt-3">
                    <div class="card-header bg-secondary text-white">Fuel Type (3/4 Wheelers)</div>
                    <div class="card-body">
                       <p class="card-text mb-1">Petrol: {{ report_data.counts_by_fuel_3_4.get('petrol', 0) }}</p>
                       <p class="card-text mb-0">Diesel: {{ report_data.counts_by_fuel_3_4.get('diesel', 0) }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="mt-4">
            <h3 class="text-center mb-3">Visual Reports</h3>
            <div class="row chart-container justify-content-center">
                 {% if charts.get('wheels') %}
                <div class="col-md-6 col-lg-4 text-center">
                    <h5>Wheels Distribution</h5>
                    <img src="{{ charts.wheels }}" alt="Wheels Distribution Pie Chart">
                </div>
                 {% endif %}
                 {% if charts.get('duration') %}
                <div class="col-md-6 col-lg-4 text-center">
                     <h5>Duration Distribution</h5>
                    <img src="{{ charts.duration }}" alt="Duration Distribution Pie Chart">
                </div>
                 {% endif %}
                 {% if charts.get('fuel') %}
                 <div class="col-md-6 col-lg-4 text-center">
                     <h5>Fuel Type (3/4 W)</h5>
                    <img src="{{ charts.fuel }}" alt="Fuel Type Distribution Pie Chart">
                </div>
                 {% endif %}
            </div>
        </div>
     {% elif request.method == 'POST' %} {# Only show 'no data' if a report was requested #}
        <div class="alert alert-info" role="alert">
            No pollution check records found for the selected date range ({{ start_date }} to {{ end_date }}).
        </div>
    {% endif %}
{% endif %}

{% endblock %}